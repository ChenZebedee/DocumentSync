<!-- TOC -->

- [HBase预分区常用方法](#hbase%e9%a2%84%e5%88%86%e5%8c%ba%e5%b8%b8%e7%94%a8%e6%96%b9%e6%b3%95)
  - [加盐](#%e5%8a%a0%e7%9b%90)
  - [哈希](#%e5%93%88%e5%b8%8c)
  - [反转](#%e5%8f%8d%e8%bd%ac)
  - [时间戳反转 - 与反转类似](#%e6%97%b6%e9%97%b4%e6%88%b3%e5%8f%8d%e8%bd%ac---%e4%b8%8e%e5%8f%8d%e8%bd%ac%e7%b1%bb%e4%bc%bc)

<!-- /TOC -->
# HBase预分区常用方法
## 加盐
    
1. 这里的加盐指的是在rowkey的前面增加随机数。具体就是给rowkey分配一个随机前缀，使得它和之前排序不同。分配的前缀种类数量和数据分散到不同的region数量相同，将写请求分散到多个RegionServers。
![加盐](https://cdn.sinaimg.cn.52ecy.cn/large/005BYqpgly1g59pti23loj30j803jjrt.jpg)
2. 降低热点问题，但是会造成读的时候，效率下降。
3. 假设有下列rowkey,表中的每一个region对应字母表中的每一个字母。以'a'开头是同一个region,
* 'b'开头的是同一个region。在表中，所有以'f'开头的都在同一个region,它们的rowkey如下：
```
    foo0001
    foo0002
    foo0003
    foo0004
```
* 现在需要将这个region分散到4个region中。选择用4个不同的盐：'a','b','c','d'在这个方案下，每一个字母前缀都会在不同的region中。加盐之后的rowkey如下：
```
    a-foo0003
    b-foo0001
    c-foo0004
    d-foo0002
```
* 所以，可以向4个不同的region写，如果再增加一行，将随机分配a,b,c,d中的一个作为前缀，并且以一个现有行作为尾部结束：
```
    a-foo0003
    b-foo0001
    c-foo0003
    c-foo0004
    d-foo0002
```

## 哈希
哈希会使同一行永远用同一个前缀加盐。哈希也可以使负载分散到整个集群，但是读却是可以预测的。使用确定的哈希可以让客户端重构完成的rowkey,使用Get操作获取正常的一行数据

## 反转
反转固定长度或者数字格式的rowkey，这样可以使得rowkey中经常改变的部分(最没有意义的部分)放在前面。这样可以有效的随机rowkey，但是牺牲了rowkey的有序性。

例子：
    
    以手机号为rowkey，可以将手机号反转后的字符串作为rowkey,这样就避免了以手机号那样比较固定开头导致热点问题
## 时间戳反转 - 与反转类似